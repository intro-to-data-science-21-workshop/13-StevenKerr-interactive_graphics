---
title: "Introduction to Data Science"
subtitle: "Interactive Plotting with plotly in R"
author: "Steve Kerr & Julian Kath"
institute: "Hertie School"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    seal: false
    css: [default, red_theme.css] #consider editing theme 
    lib_dir: libs
    includes:
      after_body: insert_logo.html
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      
--- 
class: hide-logo, middle
background-image: url(https://upload.wikimedia.org/wikipedia/commons/thumb/8/8a/Plotly_logo_for_digital_final_%286%29.png/1600px-Plotly_logo_for_digital_final_%286%29.png)
background-position: right
background-size: 50% 50%

# .center[**Interactive Plotting with plotly in R**]
--------------------------------------
## Steve Kerr & Julian Kath
## Hertie School 
## `r Sys.Date()`
      
---

# Overview

.pull-left[.font160[1. What is plotly? 
1. Why plotly?
1. How does plotly work?
1. What can plotly do? 
1. Key Takeaways
1. Resources
1. Let's Practice
]]

.pull-right[
![Image](https://imgs.xkcd.com/comics/scientific_paper_graph_quality_2x.png)
]


---
class: hide-logo, inverse, center, middle

# **What is plotly?**

---
background-image: url("https://d33wubrfki0l68.cloudfront.net/3e0445f7fc16698cc4402445259d84aa411dddc3/9abcb/diagrams/data-science-communicate.png")
background-position: center
background-size: contain

# Data Visualization

???
Image credit: [R for Data Science, Ch. 26](https://r4ds.had.co.nz/explore-intro.html)

---

# Data Visualization

</br>
</br>
</br>
</br>
</br>
.font180[.center[“The simple graph has brought more information to the data analyst’s mind than any other device.” 
</br>
</br>
John Tukey]]

---

# Data Visualization

</br>
</br>
</br>
</br>
</br>
.font200[.center[“The ~~simple~~ dynamic graph has brought more information to the data analyst’s mind than any other device.”
</br>
</br>
Julian Kath & Steve Kerr]]

---

# Types of Graphics
<<<<<<< HEAD

<details>
  <summary>
1. Static
  </summary>
.details[.center[
```{r, message = FALSE, echo = FALSE, warning = FALSE, fig.align='center'} 
=======
</details>
<details>
  <summary>
  Static Graphics
  </summary>
.details[
```{r, message = FALSE, echo = FALSE, warning = FALSE, fig.height=7, fig.width=12} 
>>>>>>> 63129b82ad7ad6c84d9119bede66fa3d11f37496
library(dplyr)
library(ggplot2)
library(gapminder)

gapminder %>% 
  filter(year == '2007') %>% 
  ggplot(aes(x = gdpPercap, y = lifeExp)) + 
  geom_point(aes(color = continent, size = pop), alpha = (3/4)) +
  labs(x = "GDP per capita", 
       y = "Life Expectancy", 
       colour = "Continent",
       size = "Population",
       title = "GDP per capita vs. Life Expectancy",
       caption = "(based on data from 2007)") +
  theme_minimal()
```
<<<<<<< HEAD
]]
=======
]
>>>>>>> 63129b82ad7ad6c84d9119bede66fa3d11f37496
</details>

<details>
  <summary>
<<<<<<< HEAD
2. Interactive
  </summary>
.details[
```{r, message = FALSE, echo = FALSE, warning = FALSE, fig.align='center'} 
=======
  Interactive Graphics
  </summary>
.details[
```{r, message = FALSE, echo = FALSE, warning = FALSE, fig.height=7, fig.width=12} 
>>>>>>> 63129b82ad7ad6c84d9119bede66fa3d11f37496
library(dplyr)
library(plotly)
library(gapminder)

### Supress misc messages
gapminder %>% 
  filter(year == '2007') %>%
  plot_ly(
    x = ~gdpPercap, 
    y = ~lifeExp, 
    size = ~pop, 
    color = ~continent, 
    text = ~country, 
    hoverinfo = "text",
    type = 'scatter',
    mode = 'markers'
  ) %>% 
  layout(title = "GDP per capita vs. Life Expectancy in 2007",
    xaxis = list(
      type = "log"
    ),
    paper_bgcolor = 'rgba(0,0,0,0)',
    plot_bgcolor = 'rgba(0,0,0,0)'
  )

### show that data is only one year (2007)
### Center output

```
]
</details>

<details>
  <summary>
<<<<<<< HEAD
3. Dynamic
  </summary>
.details[
```{r, message = FALSE, echo = FALSE, warning = FALSE, fig.align='center'} 
=======
  Dynamic Graphics
  </summary>
.details[
```{r, message = FALSE, echo = FALSE, warning = FALSE, fig.height=7, fig.width=12} 
>>>>>>> 63129b82ad7ad6c84d9119bede66fa3d11f37496
library(plotly)
library(gapminder)

### Find way to center output

gapminder  %>%
  plot_ly(
    x = ~gdpPercap, 
    y = ~lifeExp, 
    size = ~pop, 
    color = ~continent, 
    frame = ~year, 
    text = ~country, 
    hoverinfo = "text",
    type = 'scatter',
    mode = 'markers'
  ) %>% 
  layout(
    title = "GDP pre capita vs. Life Expectancy 1952-2007",
    xaxis = list(
      type = "log"
    ),
    paper_bgcolor = 'rgba(0,0,0,0)',
    plot_bgcolor = 'rgba(0,0,0,0)'
  )


```
]
</details>
<<<<<<< HEAD

---
background-image: url(https://i.imgflip.com/5rmjit.jpg)
background-position: 50% 50%
=======
>>>>>>> 63129b82ad7ad6c84d9119bede66fa3d11f37496

--
.center[
![Imgflip](https://i.imgflip.com/5rmjit.jpg)
]

---

background-image: url(https://upload.wikimedia.org/wikipedia/commons/thumb/8/8a/Plotly_logo_for_digital_final_%286%29.png/1600px-Plotly_logo_for_digital_final_%286%29.png)
background-position: center
background-size: contain

# What is plotly?

plotly is an R package for creating **interactive** and **dynamic** **web-based** graphics  

1. Audiences can directly **interact** with your data
1. **Dynamic** graphics change automatically
1. **Web-based** graphics can be easily shared 

---
class: hide-logo, inverse, center, middle

# Why plotly? 

---

# Why plotly?
<br/>
.right-column[
```{r, message=FALSE, warning=FALSE, echo=FALSE, fig.align='center'}
library(plotly)

data.frame(libraries = c("plotly.R", "rbokeh", "trellisopejs", "dygraphs", "ggvis", "ggplot2"),
           github_stars = c(2100, 293, 217, 328, 700, 5100),
           github_watch = c(287, 35, 11, 42, 128, 318),
           forks = c(1600, 65, 35, 196, 185, 1800)) -> viz_data

plot_ly(viz_data, x = ~libraries, 
        y = ~github_stars, type = "bar",
        name = "GitHub Stars", hoverinfo = "text",
        text = ~paste0("</br> Library: ", libraries,
                       "</br> Stars: ", github_stars,
                       "</br> Watchers: ", github_watch, 
                       "</br> Forks: ", forks)) %>% 
  add_trace(y = ~forks, name = "GitHub Forks") %>% 
  add_trace(y = ~github_watch, name = "GitHub Watchers") %>% 
  layout(
    title = "Plotting libraries in R",
    xaxis = list(title = "Library"),
    yaxis = list(title = "Number of Forks/ Stars/ Watchers"),
    paper_bgcolor = 'rgba(0,0,0,0)',
    plot_bgcolor = 'rgba(0,0,0,0)',
    autosize = FALSE, width = 550, 
    height = 400, 
    margin = list(l = 60, 
                  r = 50, 
                  b = 5, 
                  t = 25, 
                  pad = 5)
    )

### Adapt color of plot to match the slides 
### Consider reordering in descending/ascending order 
### Consider moving 'strenghts of interactive plotting' content to its own slide
```
]
</br>
</br>
.left-column[.font80[
####Strengths of interactive Plotting:
</br>
- Complex Information
- High-dimensional Data
- Exploratory Data Analysis
- Engaging Viewer Experience
]]

---
class: hide-logo, inverse, center, middle

# How does plotly work? 

---

# How does plotly work? 

</br>
.font70[
Transform a **ggplot2** graphic into a **plotly** graphic with **ggplotly()**
</br>
<details>
  <summary>
  Example
  </summary>
.details[
```{r, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE}
library(ggplot2)
gg <- mtcars %>% 
  ggplot(aes(x = wt)) +
  geom_histogram(bins = 10, binwidth = 0.5)
p_gg <- ggplotly(gg)
```
]
</details>

<details>
  <summary>
  ggplot
  </summary>
.details[
```{r, fig.width=5, fig.height=4, eval=TRUE, warning=FALSE, message=FALSE, echo=FALSE}
gg
```
]
</details>

<details>
  <summary>
  ggplotly
  </summary>
.details[
```{r, message=FALSE, warning=FALSE, fig.width=5, fig.height=4, fig.align='center', echo=FALSE}
p_gg
```
]
</details>

Directly initialize a **plotly** graphic with **plot_ly()**
</br>
<details>
  <summary>
  plot_ly
  </summary>
.details[
```{r, message=FALSE, warning=FALSE, fig.width=5, fig.height=4, fig.align='center', echo=FALSE}
mtcars %>% 
  plot_ly(x = ~wt) %>% 
  add_histogram(nbins=10, xbins=list(size=0.5))
```
]
</details>


]
---
# #1 plotly
<details>
  <summary>
  Grammar of Basic Plotting in plotly
  </summary>
<<<<<<< HEAD
.details[.code100[
=======
.details[
.code180[
>>>>>>> 63129b82ad7ad6c84d9119bede66fa3d11f37496
```{r, eval=TRUE, prompt=TRUE, message=FALSE, warning=FALSE}
library(plotly)
fig <- cars %>% 
  plot_ly(x = ~speed, y = ~dist) %>% 
  add_markers() %>% 
  layout(title = list(text = "Speed vs. Distance", 
                      x = 0.1, y = 0.01),
         paper_bgcolor = 'rgba(0,0,0,0)',
         plot_bgcolor = 'rgba(0,0,0,0)')
```
<<<<<<< HEAD
]]
=======
]
]
>>>>>>> 63129b82ad7ad6c84d9119bede66fa3d11f37496
</details>

<details>
  <summary>
  Plot
  </summary>
.details[
.code10[
```{r, echo=FALSE}
fig
```
]]
</details>

<details>
  <summary>
  Key Terms
  </summary>
.details[
* **Grammar of Graphics**
* Trace: the data
* Trace Type: ex. histogram, pie, scatter, etc.
* Attribute: the style
]
</details>

</details>
<details>
  <summary>
  Takeaways
  </summary>
.details[
* Call plotly with **plot_ly** and map variables
* Chain traces with pipes **%>%** 
* Always pass variables with a tilde **~** 
* You will oftentimes need to pass parameters in **lists**!
]
</details>

---

# #1 ggplot2 → plotly

- If you use ggplot2, **ggplotly()** converts your static plot to an interactive web-based version! 
</br>
- This functionality can be really helpful for quickly adding interactivity to your existing ggplot2 workflow

### Could insert ggplotly example here 

---

# #2 plotly (continued)

- By default, ggplotly() tries to replicate the static ggplot2 version exactly 
- Some useful ones include layout() (for customizing the layout), 
- add_traces() (and its higher-level add_*() siblings, for example add_polygons(), for adding new traces/data), 
- subplot() (for combining multiple plotly objects)

---
class: hide-logo, inverse, center, middle

# What else can plotly do? 

---

# What else can plotly do? 

.center2[![plots and charts and boxes](https://i.imgflip.com/5qzavw.jpg)]

### This info may be redundant at this point in the presentation. Either incorporate earlier or nix

---
# What else can plotly do?


.center2[![plotly gallery](https://upload.wikimedia.org/wikipedia/en/0/0a/Gallery_of_Plotly_Graphs.png)
]

### This info may be redundant at this point in the presentation. Either incorporate earlier or nix

---
# Installation
Install the **plotly** package from [CRAN](https://cran.r-project.org/web/packages/plotly/index.html):

```{r eval=FALSE, tidy=FALSE}
install.packages("plotly")
```

### This slide may be better for the tutorial session 
---

# Animated Plots in plotly
<details>
  <summary>
  Code chunk
  </summary>
.details[.code80[
```{r eval=TRUE, message=FALSE, warning=FALSE, prompt=TRUE}

library(plotly)
library(gapminder) # dataset
library(tidyverse)

gapminder %>% 
  plot_ly(x = ~gdpPercap, y = ~lifeExp, # variables
          hoverinfo = "text",
          text = ~paste("</br> Country: ", country, # Hover text box
                        "</br> GDP per capita: ", round(gdpPercap, 0),
                        "</br> Life Expectancy: ", lifeExp,
                        "</br> Population: ", round(pop/1000000, 0), " Mio")) %>% 
  add_text(x = 6500, y = 40, # Background text
           text = ~year, frame = ~year,
           textfont = list(size = 150, 
                           color = toRGB("gray80"))) %>% 
  add_markers(size = ~pop, color = ~continent, # Customizing Markers, Mapping continent onto color
              frame = ~year, ids = ~country,
              marker = list(sizemode = "diameter")) %>% 
  layout(title = "GDP per capita vs. Life Expectancy from 1952 to 2007",
         xaxis = list(type = "log",
                      title = "GDP per capita"), 
         yaxis = list(type = "log",
                      title = "Life Expectancy at birth"),
         paper_bgcolor = 'rgba(0,0,0,0)', # Transparent Background Color
         plot_bgcolor = 'rgba(0,0,0,0)',
         showlegend = FALSE) %>% 
  animation_opts(frame = "500", # Setting animation options. 
                 transition = "500",
                 easing = "linear",
                 redraw = TRUE) %>% 
  animation_slider(hide = TRUE)  -> ani_plot
```
]]
</details>
<details>
  <summary>
  Plot
  </summary>
</br>
.details[
```{r eval=TRUE, echo=FALSE}

ani_plot
  
```
]
</details>

---
# Linking plots & Filters

<details>
  <summary>
  Code Chunk Linked Plots & Filtering Options
  </summary>
.details[.code70[
```{r eval=TRUE, message=FALSE, warning=FALSE, prompt=TRUE}
library(crosstalk)
library(openintro) # dataset

shared_data <- SharedData$new(cia_factbook, 
                              key = ~country) # This creates a shared dataframe for both plots

p1 <- shared_data %>% # First Subplot
  plot_ly(x = ~population, # X-axis vector
          y = ~internet_users, # Y-axis vector
          hoverinfo = "text", 
          text = ~country) %>% # Assigning the Country name to the hover info
  add_markers() %>% 
  layout(title = "Internet Users vs. Total Population",
         xaxis = list(type = "log", title = "Population"), 
         yaxis = list(type = "log", title = "Internet Users"), # Plot Labels, Axis scaling
         paper_bgcolor = 'rgba(0,0,0,0)',
         plot_bgcolor = 'rgba(0,0,0,0)') %>% # Set transparent background
  highlight(on = "plotly_click", persistent = TRUE) # Specifies what event triggers selection

p2 <- shared_data %>% # Second Subplot
  plot_ly(x = ~population_growth_rate, 
          y = ~net_migration_rate, 
          hoverinfo = "text", 
          text = ~country) %>% 
  add_markers(color = "red") %>% # Only required in bscols linked graphs
  layout(title = "Population Growth vs Net Migration",
         xaxis = list(type = "log", title = "Population Growth Rate"), 
         yaxis = list(type = "log", title = "Net Migration Rate"),
         paper_bgcolor = 'rgba(0,0,0,0)',
         plot_bgcolor = 'rgba(0,0,0,0)') %>% 
  highlight(on = "plotly_click", persistent = TRUE) # persistent = TRUE allows multiple selections

bscols(widths = c(2, 5, 5), # Arrangement of panes in output
       list(filter_select(id = "countries", label = "Select a Country",
                  sharedData = shared_data, group = ~country), # Searchable Filter
            filter_slider(id = "birthslide", label = "Birth rate",
                 sharedData = shared_data, column = ~birth_rate), # Slider Filters
            filter_slider(id = "deathslide", label = "Death rate",
                 sharedData = shared_data, column = ~death_rate)),
       p1, p2) -> linked_plot # The Two subplots
  
```
]]
</details>

<details>
  <summary>
  Linked Plots
  </summary>
.details[
```{r eval=TRUE, warning=FALSE, message=FALSE, echo=FALSE}
linked_plot
  
```
]
</details>
---
class: hide-logo, inverse, center, middle

# Key Takeaways

---
# Key Takeaways

- plotly is an R package for creating **interactive** and **dynamic** **web-based** graphics  
- plotly graphics can be created by (1) converting ggplot() graphics and (2) initializing directly with plot_ly()
- Key features include the ability to animate graphs, links plots & filters, allow audience to interact with your data 

---
class: hide-logo, inverse, center, middle

# Resources

---

# Resources 

If you're interested in learning more about plotly, check these out: 
- 
- 
- 

---

# References 

- 
- 
- 
--- 
background-image: url(https://imgs.xkcd.com/comics/scientific_paper_graph_quality_2x.png)

--- 
class: hide-logo, inverse, center, middle

# Let's practice!

