---
title: "Introduction to Data Science"
subtitle: "Interactive Plotting with plotly in R"
author: "Steve Kerr & Julian Kath"
institute: "Hertie School"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    seal: false
    css: [default, red_theme.css]
    lib_dir: libs
    includes:
      after_body: insert_logo.html
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      
--- 
class: hide-logo, middle
background-image: url(https://upload.wikimedia.org/wikipedia/commons/thumb/8/8a/Plotly_logo_for_digital_final_%286%29.png/1600px-Plotly_logo_for_digital_final_%286%29.png)
background-position: right
background-size: 50% 50%

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
```

# .center[**Interactive Plotting with plotly in R**]
--------------------------------------
## Steve Kerr & Julian Kath
## Hertie School 
## `r Sys.Date()`
      
---

# Overview

.pull-left[.font160[
<br>
</br>
1. What is plotly? 
1. Why plotly?
1. How does plotly work?
1. What can plotly do? 
1. Conclusion
1. Resources
1. Let's Practice!
]]

.pull-right[
</br>
</br>
</br>
</br>
</br>
![Image](https://imgs.xkcd.com/comics/scientific_paper_graph_quality_2x.png)
]


---
class: hide-logo, inverse, center, middle

# **What is plotly?**

---
background-image: url("https://d33wubrfki0l68.cloudfront.net/3e0445f7fc16698cc4402445259d84aa411dddc3/9abcb/diagrams/data-science-communicate.png")
background-position: center
background-size: contain

# Data Visualization

???
primary: Explanatory Data that allows audience to explore for themselves

Image credit: [R for Data Science, Ch. 26](https://r4ds.had.co.nz/explore-intro.html)

---

# Data Visualization

</br>
</br>
</br>
</br>
</br>
.font180[.center[“The simple graph has brought more information to the data analyst’s mind than any other device.” 
</br>
</br>
John Tukey]]

---

# Data Visualization

</br>
</br>
</br>
</br>
</br>
.font200[.center[“The ~~simple~~ dynamic graph has brought more information to the data analyst’s mind than any other device.”
</br>
</br>
Julian Kath & Steve Kerr]]

---

# Types of Graphics

.center[.center2[.font200[
<br></br>
# 1. Static
<br></br>
# 2. Interactive
<br></br>
# 3. Dynamic
]]]
---

# Types of Graphics

.font100[
<details>
  <summary>
Static
  </summary>
.details[.center[
```{r static, message = FALSE, echo = FALSE, warning = FALSE, fig.height=7, fig.width=12} 
library(dplyr)
library(ggplot2)
library(gapminder)

gapminder %>% 
  filter(year == '2007') %>% 
  ggplot(aes(x = gdpPercap, y = lifeExp)) + 
  geom_point(aes(color = continent, size = pop), alpha = (3/4)) +
  labs(x = "GDP per capita", 
       y = "Life Expectancy", 
       colour = "Continent",
       size = "Population",
       title = "GDP per capita vs. Life Expectancy in 2007",
       caption = "(based on data from 2007)") +
  theme_minimal() + 
  scale_x_continuous(trans = 'log10')
```
]]
</details>

<details>
  <summary>
Interactive
  </summary>
.details[
```{r interactive, message = FALSE, echo = FALSE, warning = FALSE, fig.height=7, fig.width=12} 
library(dplyr)
library(plotly)
library(gapminder)

gapminder %>% 
  filter(year == '2007') %>%
  plot_ly(
    x = ~gdpPercap, 
    y = ~lifeExp, 
    size = ~pop, 
    color = ~continent, 
    text = ~country, 
    hoverinfo = "text",
    type = 'scatter',
    mode = 'markers'
  ) %>% 
  layout(title = "GDP per capita vs. Life Expectancy in 2007",
    xaxis = list(
      type = "log"
    ),
    paper_bgcolor = 'rgba(0,0,0,0)',
    plot_bgcolor = 'rgba(0,0,0,0)'
  )

```
]]
</details>

---

```{r dynamic, message = FALSE, echo = FALSE, warning = FALSE, fig.height = 7, fig.width = 12} 
library(dplyr) 
library(plotly)
library(gapminder)

gapminder  %>%
  plot_ly(
    x = ~gdpPercap, 
    y = ~lifeExp, 
    color = ~continent, 
    frame = ~year, 
    text = ~country, 
    hoverinfo = "text",
    type = 'scatter',
    mode = 'markers'
  ) %>% 
  layout(
    title = "GDP pre capita vs. Life Expectancy 1952-2007",
    xaxis = list(
      type = "log"
    ),
    paper_bgcolor = 'rgba(0,0,0,0)',
    plot_bgcolor = 'rgba(0,0,0,0)'
  )
```


---

# Types of Graphics 

.center2[
![Imgflip](https://i.imgflip.com/5rmjit.jpg)
]

---

background-image: url(https://upload.wikimedia.org/wikipedia/commons/thumb/8/8a/Plotly_logo_for_digital_final_%286%29.png/1600px-Plotly_logo_for_digital_final_%286%29.png)
background-position: bottom
background-size: 75% 75% 

# What is plotly?

.font150[
plotly is an R package for creating **interactive** and **dynamic** **web-based** graphics  

1. Audiences can directly **interact** with your data
1. **Dynamic** graphics change automatically
1. **Web-based** graphics can be easily shared 
]
---
class: hide-logo, inverse, center, middle

# **Why plotly?** 

---

# Why plotly?

```{r ranking, message=FALSE, warning=FALSE, echo=FALSE}
library(plotly)


data.frame(libraries = c("plotly.R", "rbokeh", "trellisopejs", "dygraphs", "ggvis", "ggplot2"),
           github_stars = c(2100, 293, 217, 328, 700, 5100),
           github_watch = c(287, 35, 11, 42, 128, 318),
           forks = c(1600, 65, 35, 196, 185, 1800)) -> viz_data

plot_ly(viz_data, x = ~libraries, 
        y = ~github_stars, type = "bar",
        name = "GitHub Stars", hoverinfo = "text",
        text = ~paste0("</br> Library: ", libraries,
                       "</br> Stars: ", github_stars,
                       "</br> Watchers: ", github_watch, 
                       "</br> Forks: ", forks)) %>% 
  add_trace(y = ~forks, name = "GitHub Forks") %>% 
  add_trace(y = ~github_watch, name = "GitHub Watchers") %>% 
  layout(
    title = "Plotting libraries in R",
    xaxis = list(title = "Library"),
    yaxis = list(title = "Number of Forks/ Stars/ Watchers"),
    paper_bgcolor = 'rgba(0,0,0,0)',
    plot_bgcolor = 'rgba(0,0,0,0)',
    autosize = FALSE, width = 550, 
    height = 400, 
    margin = list(l = 60, 
                  r = 50, 
                  b = 5, 
                  t = 25, 
                  pad = 5))
```

---

# Why plotly? 

.font200[
Strengths of interactive Plotting:
- Complex Information
- High-dimensional data
- Exploratory data analysis
- Engaging viewer experience
]

---
class: hide-logo, inverse, center, middle

# **How does plotly work?**

---

# How does plotly work? 

.font140[
## 1. Transform **ggplot** graphics into **plotly** graphics with **ggplotly()**
]

--

</br>
.code160[
```{r ggplotly}
library(ggplot2)

ggplot <- ggplot(data = mtcars, aes(x = wt, y = mpg)) + 
  geom_point(size = 4)

ggplotly <- ggplotly(ggplot)

```
]

--
</br>
.font140[
## 2. Initialize **plotly** graphics directly with **plot_ly()**
]
--
</br>
.code160[
```{r plotly}
library(plotly)

plotly <- plot_ly(mtcars, x = ~wt, y = ~mpg)
```
]

---

# #1 ggplot →️ plotly

.font150[
- If you use ggplot2, **ggplotly()** converts your static plot to an interactive web-based version!
]
--
<br></br>
.font150[
- This functionality can be really helpful for quickly adding interactivity to your existing ggplot2 workflow
]

--
.center[
![Level Up](https://media3.giphy.com/media/qfridHRcLlMLMtWueu/giphy.gif?cid=ecf05e47p7c96cu7pi9td856dcfckt7rsk2mcwfaf1g58qrj&rid=giphy.gif&ct=g)
]

---

# #1 ggplot →️ plotly

.code120[
```{r, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE}
library(ggplot2)
library(plotly)

gg <- mtcars %>% 
  ggplot(aes(x = wt)) +
  geom_histogram(bins = 10, binwidth = 0.5)

p_gg <- ggplotly(gg)
```
]

.pull-left[
```{r, eval=TRUE, warning=FALSE, message=FALSE, echo=FALSE, fig.width=5, fig.height=5}
gg
```
]

.pull-right[
```{r, eval=TRUE, warning=FALSE, message=FALSE, echo=FALSE, fig.width=5, fig.height=5}
p_gg
```
]

---

# #2 plotly 

```{r, eval=TRUE, message=FALSE, warning=FALSE, fig.width=5, fig.height=4, fig.align='center', echo=TRUE}
fig <- mtcars %>% 
  plot_ly(x = ~wt) %>% 
  add_histogram(nbins=10, xbins=list(size=0.5))

fig
```


```{r cars3, eval=TRUE, prompt=TRUE, message=FALSE, warning=FALSE}
fig <- cars %>% 
  plot_ly(x = ~speed, y = ~dist) %>% 
  add_markers() %>% 
  layout(title = list(text = "Speed vs. Distance", 
                      x = 0.1, y = 0.01),
         paper_bgcolor = 'rgba(0,0,0,0)',
         plot_bgcolor = 'rgba(0,0,0,0)')

fig
```

---
# Grammar of Graphics 
.font170[
- Key Terms
  + **Trace**: the data
  + **Trace Type**: ex. histogram, pie, scatter, etc.
  + **Attribute**: the style
  ]
--

.font170[- Call plotly with **plot_ly** and map variables]
--

.font170[- Chain traces with pipes **%>%** ]
--

.font170[- Always pass variables with a tilde **~** ]
--

.font170[- You will oftentimes need to pass parameters in **lists**!]

---
class: hide-logo, inverse, center, middle

# **What else can plotly do?** 


---

# Animated Plots
<details>
  <summary>
  Code chunk
  </summary>
.details.code80[
```{r eval=TRUE, message=FALSE, warning=FALSE, prompt=TRUE}

library(plotly)
library(gapminder) # dataset
library(tidyverse)

gapminder %>% 
  plot_ly(x = ~gdpPercap, y = ~lifeExp, # variables
          hoverinfo = "text",
          text = ~paste("</br> Country: ", country, # Hover text box
                        "</br> GDP per capita: ", round(gdpPercap, 0),
                        "</br> Life Expectancy: ", lifeExp,
                        "</br> Population: ", round(pop/1000000, 0), " Mio")) %>% 
  add_text(x = 6500, y = 40, # Background text
           text = ~year, frame = ~year,
           textfont = list(size = 150, 
                           color = toRGB("gray80"))) %>% 
  add_markers(size = ~pop, color = ~continent, # Customizing Markers, Mapping continent onto color
              frame = ~year, ids = ~country,
              marker = list(sizemode = "diameter")) %>% 
  layout(title = "GDP per capita vs. Life Expectancy from 1952 to 2007",
         xaxis = list(type = "log",
                      title = "GDP per capita"), 
         yaxis = list(type = "log",
                      title = "Life Expectancy at birth"),
         paper_bgcolor = 'rgba(0,0,0,0)', # Transparent Background Color
         plot_bgcolor = 'rgba(0,0,0,0)',
         showlegend = FALSE) %>% 
  animation_opts(frame = "500", # Setting animation options. 
                 transition = "500",
                 easing = "linear",
                 redraw = TRUE) %>% 
  animation_slider(hide = TRUE)  -> ani_plot
```
]
</details>
<details>
  <summary>
  Plot
  </summary>
</br>
.details[
```{r eval=TRUE, echo=FALSE}

ani_plot
  
```
]
</details>

---
# Linking Plots 

<details>
  <summary>
  Code Chunk Linked Plots & Filtering Options
  </summary>
.details[.code70[
```{r eval=TRUE, message=FALSE, warning=FALSE, prompt=TRUE}
library(crosstalk)
library(openintro) # dataset

shared_data <- SharedData$new(cia_factbook, 
                              key = ~country) # This creates a shared dataframe for both plots

p1 <- shared_data %>% # First Subplot
  plot_ly(x = ~population, # X-axis vector
          y = ~internet_users, # Y-axis vector
          hoverinfo = "text", 
          text = ~country) %>% # Assigning the Country name to the hover info
  add_markers() %>% 
  layout(title = "Internet Users vs. Total Population",
         xaxis = list(type = "log", title = "Population"), 
         yaxis = list(type = "log", title = "Internet Users"), # Plot Labels, Axis scaling
         paper_bgcolor = 'rgba(0,0,0,0)',
         plot_bgcolor = 'rgba(0,0,0,0)') %>% # Set transparent background
  highlight(on = "plotly_click", persistent = TRUE) # Specifies what event triggers selection

p2 <- shared_data %>% # Second Subplot
  plot_ly(x = ~population_growth_rate, 
          y = ~net_migration_rate, 
          hoverinfo = "text", 
          text = ~country) %>% 
  add_markers(color = "red") %>% # Only required in bscols linked graphs
  layout(title = "Population Growth vs Net Migration",
         xaxis = list(type = "log", title = "Population Growth Rate"), 
         yaxis = list(type = "log", title = "Net Migration Rate"),
         paper_bgcolor = 'rgba(0,0,0,0)',
         plot_bgcolor = 'rgba(0,0,0,0)') %>% 
  highlight(on = "plotly_click", persistent = TRUE) # persistent = TRUE allows multiple selections

bscols(widths = c(2, 5, 5), # Arrangement of panes in output
       list(filter_select(id = "countries", label = "Select a Country",
                  sharedData = shared_data, group = ~country), # Searchable Filter
            filter_slider(id = "birthslide", label = "Birth rate",
                 sharedData = shared_data, column = ~birth_rate), # Slider Filters
            filter_slider(id = "deathslide", label = "Death rate",
                 sharedData = shared_data, column = ~death_rate)),
       p1, p2) -> linked_plot # The Two subplots
  
```
]]
</details>

<details>
  <summary>
  Linked Plots
  </summary>
.details[
```{r eval=TRUE, warning=FALSE, message=FALSE, echo=FALSE}
linked_plot
  
```
]
</details>

---

# Filters

---

# Subplots

---
class: hide-logo, inverse, center, middle

# **Conclusion**

---
# Conclusion


.font160[
- plotly is an R package for creating **interactive** and **dynamic** **web-based** graphics
<br></br>
- plotly graphics can be created by (1) converting ggplot() graphics and (2) initializing directly with plot_ly()
<br></br>
- Key features include the ability to animate graphs, links plots & filters, allow audience to interact with your data
<br></br>
- plotly might not always be the right tool!
]

---

# Resources 


.font200[
- [Getting Started with plotly in R](https://plotly.com/r/getting-started/)
<br></br>
- [Interactive web-based data visualization with R, plotly, and shiny](https://plotly-r.com/)
<br></br>
- [Getting Started with plotly in ggplot2](https://plotly.com/ggplot2/getting-started/)
<br></br>
- [plotly Cheat Sheet](https://images.plot.ly/plotly-documentation/images/r_cheat_sheet.pdf)
]
---

# References 

.font200[
- 
- 
- 
]

---
class: hide-logo, inverse, center, middle

# **Let's practice!**

