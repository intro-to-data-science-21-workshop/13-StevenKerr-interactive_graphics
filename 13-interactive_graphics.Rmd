---
title: "Introduction to Data Science"
subtitle: "Interactive Plotting with plotly in R"
author: "Steve Kerr & Julian Kath"
institute: "Hertie School"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    seal: false
    css: [default, red_theme.css] #consider editing theme 
    lib_dir: libs
    includes:
      after_body: insert_logo.html
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      
--- 
class: hide-logo, middle
background-image: url(https://upload.wikimedia.org/wikipedia/commons/thumb/8/8a/Plotly_logo_for_digital_final_%286%29.png/1600px-Plotly_logo_for_digital_final_%286%29.png)
background-position: right
background-size: 50% 50%

# .center[Interactive Plotting with plotly in R]
--------------------------------------
## Steve Kerr & Julian Kath
## Hertie School 
## `r Sys.Date()`
      
---
class: hide-logo
background-image: url(https://upload.wikimedia.org/wikipedia/commons/thumb/8/8a/Plotly_logo_for_digital_final_%286%29.png/1600px-Plotly_logo_for_digital_final_%286%29.png)
background-position: right
background-size: contain

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
```

### Consider nixing if we include logo in title slide

???
Image credit: [Wikimedia Commons](https://commons.wikimedia.org/wiki/File:Plotly-logo-01-square.png)

---

# Overview

1. What is plotly? 
1. Why plotly?
1. How does plotly work?
1. What can plotly do? 
1. Key Takeaways
1. Resources
1. Conclusion

---
class: hide-logo, inverse, center, middle

# What is plotly? 

---
background-image: url("https://d33wubrfki0l68.cloudfront.net/795c039ba2520455d833b4034befc8cf360a70ba/558a5/diagrams/data-science-explore.png")
background-position: center
background-size: contain

# Data Visualization

???
Image credit: [R for Data Science, Ch. 2](https://r4ds.had.co.nz/explore-intro.html)

---


# Data Visualization

</br>
</br>
</br>
</br>
</br>
</br>
.center[“The simple graph has brought more information to the data analyst’s mind than any other device.” 
</br>
</br>
John Tukey]

---

# Data Visualization

.center[“The ~~simple~~ dynamic graph has brought more information to the data analyst’s mind than any other device.”

Julian Kath & Steve Kerr]

---

# Types of Graphics

1. Static
1. Interactive
1. Dynamic

---

# Static Graphics

```{r, message = FALSE, echo = FALSE, warning = FALSE, fig.align='center'} 
library(dplyr)
library(ggplot2)
library(gapminder)

df <- gapminder %>% 
  filter(year == '2007')
fig1 <- df %>% 
  ggplot(aes(x = gdpPercap, y = lifeExp)) + geom_point(aes(color = continent, size = pop), alpha = (3/4))

### log gdpPercap
### update labels 
### make clear that this is for one year (2007) 
### update color palette to remain consistent across static, interactive, and dynamic plots

fig1
```


---

# Interactive Graphics

```{r, message = FALSE, echo = FALSE, warning = FALSE, fig.align='center'} 
library(dplyr)
library(plotly)
library(gapminder)

### Supress misc messages

df <- gapminder %>% 
  filter(year == '2007')
fig2 <- df %>%
  plot_ly(
    x = ~gdpPercap, 
    y = ~lifeExp, 
    size = ~pop, 
    color = ~continent, 
    text = ~country, 
    hoverinfo = "text",
    type = 'scatter',
    mode = 'markers'
  )
fig2 <- fig2 %>% layout(
    xaxis = list(
      type = "log"
    )
  )

### show that data is only one year (2007)
### Center output

fig2

```
---

# Dynamic Graphics

```{r, message = FALSE, echo = FALSE, warning = FALSE, fig.align='center'} 
library(plotly)
library(gapminder)

### Find way to center output

df <- gapminder 
fig3 <- df %>%
  plot_ly(
    x = ~gdpPercap, 
    y = ~lifeExp, 
    size = ~pop, 
    color = ~continent, 
    frame = ~year, 
    text = ~country, 
    hoverinfo = "text",
    type = 'scatter',
    mode = 'markers'
  )
fig3 <- fig3 %>% layout(
    xaxis = list(
      type = "log"
    )
  )

fig3

```

---
background-image: url(https://i.imgflip.com/5rmjit.jpg)
background-position: 50% 50%

???
Image credit: [Imgflip](https://imgflip.com/i/5rmjit)

---
background-image: url(https://upload.wikimedia.org/wikipedia/commons/thumb/8/8a/Plotly_logo_for_digital_final_%286%29.png/1600px-Plotly_logo_for_digital_final_%286%29.png)
background-position: center
background-size: contain

# What is plotly?

plotly is an R package for creating **interactive** and **dynamic** **web-based** graphics  

1. Audiences can directly **interact** with your data
1. **Dynamic** graphics change automatically
1. **Web-based** graphics can be easily shared 

---
class: hide-logo, inverse, center, middle

# Why plotly? 

---

# Why plotly?
<br/>
.right-column[
```{r, message=FALSE, warning=FALSE, echo=FALSE, fig.align='center'}
library(plotly)

data.frame(libraries = c("plotly.R", "rbokeh", "trellisopejs", "dygraphs", "ggvis", "ggplot2"),
           github_stars = c(2100, 293, 217, 328, 700, 5100),
           github_watch = c(287, 35, 11, 42, 128, 318),
           forks = c(1600, 65, 35, 196, 185, 1800)) -> viz_data

plot_ly(viz_data, x = ~libraries, 
        y = ~github_stars, type = "bar",
        name = "GitHub Stars", hoverinfo = "text",
        text = ~paste0("</br> Library: ", libraries,
                       "</br> Stars: ", github_stars,
                       "</br> Watchers: ", github_watch, 
                       "</br> Forks: ", forks)) %>% 
  add_trace(y = ~forks, name = "GitHub Forks") %>% 
  add_trace(y = ~github_watch, name = "GitHub Watchers") %>% 
  layout(
    title = "Plotting libraries in R",
    xaxis = list(title = "Library"),
    yaxis = list(title = "Number of Forks/ Stars/ Watchers"),
         paper_bgcolor = 'rgba(0,0,0,0)',
         plot_bgcolor = 'rgba(0,0,0,0)',
         autosize = FALSE, width = 550, 
         height = 400, margin = list(l = 60, r = 50, b = 5, t = 25, pad = 5))

### Adapt color of plot to match the slides 
### Consider reordering in descending/ascending order 
### Consider moving 'strenghts of interactive plotting' content to its own slide
```
]
</br>
</br>
.left-column[.font80[
####Strengths of interactive Plotting:
</br>
- Complex Information
- High-dimensional Data
- Exploratory Data Analysis
- Engaging Viewer Experience
]]

---
class: hide-logo, inverse, center, middle

# How does plotly work? 

---

# How does plotly work? 

</br>
### #1 Transform a **ggplot2** graphic into a **plotly** graphic
</br>
- **ggplotly()**

</br>
<details>
  <summary>
  Example
  </summary>
.details[
```{r, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE}
library(ggplot2)
gg <- mtcars %>% 
  ggplot(aes(x = wt)) +
  geom_histogram()
```
]
</details>

<details>
  <summary>
  Plot
  </summary>
.details[
```{r, eval=TRUE, message=FALSE, warning=FALSE, fig.height=4, fig.width=4}
ggplotly(gg) 
```
]
</details>
### Could conisder moving the example to its own slide

### #2 Directly initialize a **plotly** graphic 
</br>
- **plot_ly()**

    
---

# #1 plotly
<details>
  <summary>
  Grammar of Basic Plotting in plotly
  </summary>
.details[
.code100[
```{r, eval=TRUE, prompt=TRUE, message=FALSE, warning=FALSE}
library(plotly)
fig <- cars %>% 
  plot_ly(x = ~speed, y = ~dist) %>% 
  add_markers() %>% 
  layout(title = list(text = "Speed vs. Distance", 
                      x = 0.1, y = 0.01),
         paper_bgcolor = 'rgba(0,0,0,0)',
         plot_bgcolor = 'rgba(0,0,0,0)')
```
]
]
</details>

<details>
  <summary>
  Plot
  </summary>
.details[
.code10[
```{r, echo=FALSE}
fig
```
</details>

<details>
  <summary>
  Takeaways
  </summary>
.details[
* Call plotly with **plot_ly** and map variables
* Chain traces with pipes **%>%** 
* Always pass variables with a tilde **~** 
* You will oftentimes need to pass parameters in **lists**!
]
</details>

### Consider separating these into separate slides?
---

# How does plotly work? 

- Grammar of Graphics
    - similar to ggplot2
- Key Terms
    - Trace: the data
    - Trace Type: ex. histogram, pie, scatter, etc.
    - Attribute: the style
    
#### Consider merging this info with the previous Grammar of Graphics slide

---

# #1 ggplot2 → plotly

- If you use ggplot2, **ggplotly()** converts your static plot to an interactive web-based version! 
</br>
- This functionality can be really helpful for quickly adding interactivity to your existing ggplot2 workflow

### Could insert ggplotly example here 

---

# ggplot2 Refresher

### Grammar of Graphics:
</br>
1. Data
1. Aesthetics
  - aes()
1. Add layers
  - geom_point()

### Consider nixing

---
# ggplot2 Refresher (continued)

- By default, ggplotly() tries to replicate the static ggplot2 version exactly 
- Some useful ones include layout() (for customizing the layout), 
- add_traces() (and its higher-level add_*() siblings, for example add_polygons(), for adding new traces/data), 
- subplot() (for combining multiple plotly objects)

---

# #2 plotly

## Grammar of Graphics (similar to ggplot2):
</br>
1. Trace
  - the data
1. Trace Type
  - ex. histogram, pie, scatter, etc.
1. Attribute
  - visual and/or interactive properties

---

# #2 plotly (continued)

- By default, ggplotly() tries to replicate the static ggplot2 version exactly 
- Some useful ones include layout() (for customizing the layout), 
- add_traces() (and its higher-level add_*() siblings, for example add_polygons(), for adding new traces/data), 
- subplot() (for combining multiple plotly objects)

---
class: hide-logo, inverse, center, middle

# What else can plotly do? 

---

# What else can plotly do? 

.center2[![plots and charts and boxes](https://i.imgflip.com/5qzavw.jpg)]

### This info may be redundant at this point in the presentation. Either incorporate earlier or nix

---
# What else can plotly do?


.center2[![plotly gallery](https://upload.wikimedia.org/wikipedia/en/0/0a/Gallery_of_Plotly_Graphs.png)
]

### This info may be redundant at this point in the presentation. Either incorporate earlier or nix

---
# Installation
Install the **plotly** package from [CRAN](https://cran.r-project.org/web/packages/plotly/index.html):

```{r eval=FALSE, tidy=FALSE}
install.packages("plotly")
```

### This slide may be better for the tutorial session 
---

# Animated Plots in plotly
<details>
  <summary>
  Code chunk
  </summary>
.details[.code80[
```{r eval=TRUE, message=FALSE, warning=FALSE, prompt=TRUE}

library(plotly)
library(gapminder) # dataset
library(tidyverse)

gapminder %>% 
  plot_ly(x = ~gdpPercap, y = ~lifeExp, # variables
          hoverinfo = "text",
          text = ~paste("</br> Country: ", country, # Hover text box
                        "</br> GDP per capita: ", round(gdpPercap, 0),
                        "</br> Life Expectancy: ", lifeExp,
                        "</br> Population: ", round(pop/1000000, 0), " Mio")) %>% 
  add_text(x = 6500, y = 40, # Background text
           text = ~year, frame = ~year,
           textfont = list(size = 150, 
                           color = toRGB("gray80"))) %>% 
  add_markers(size = ~pop, color = ~continent, # Customizing Markers, Mapping continent onto color
              frame = ~year, ids = ~country,
              marker = list(sizemode = "diameter")) %>% 
  layout(title = "GDP per capita vs. Life Expectancy from 1952 to 2007",
         xaxis = list(type = "log",
                      title = "GDP per capita"), 
         yaxis = list(type = "log",
                      title = "Life Expectancy at birth"),
         paper_bgcolor = 'rgba(0,0,0,0)', # Transparent Background Color
         plot_bgcolor = 'rgba(0,0,0,0)',
         showlegend = FALSE) %>% 
  animation_opts(frame = "500", # Setting animation options. 
                 transition = "500",
                 easing = "linear",
                 redraw = TRUE) %>% 
  animation_slider(hide = TRUE)  -> ani_plot
```
]]
</details>
<details>
  <summary>
  Plot
  </summary>
.details[
```{r eval=TRUE, render=FALSE, echo=FALSE}

ani_plot
  
```
]
</details>

---
# Linking plots & Filters

<details>
  <summary>
  Code Chunk Linked Plots & Filtering Options
  </summary>
.details[.code70[
```{r eval=TRUE, message=FALSE, warning=FALSE, prompt=TRUE}
library(crosstalk)
library(openintro) # dataset

shared_data <- SharedData$new(cia_factbook, 
                              key = ~country) # This creates a shared dataframe for both plots

p1 <- shared_data %>% # First Subplot
  plot_ly(x = ~population, # X-axis vector
          y = ~internet_users, # Y-axis vector
          hoverinfo = "text", 
          text = ~country) %>% # Assigning the Country name to the hover info
  add_markers() %>% 
  layout(title = "Internet Users vs. Total Population",
         xaxis = list(type = "log", title = "Population"), 
         yaxis = list(type = "log", title = "Internet Users"), # Plot Labels, Axis scaling
         paper_bgcolor = 'rgba(0,0,0,0)',
         plot_bgcolor = 'rgba(0,0,0,0)') %>% # Set transparent background
  highlight(on = "plotly_click", persistent = TRUE) # Specifies what event triggers selection

p2 <- shared_data %>% # Second Subplot
  plot_ly(x = ~population_growth_rate, 
          y = ~net_migration_rate, 
          hoverinfo = "text", 
          text = ~country) %>% 
  add_markers(color = "red") %>% # Only required in bscols linked graphs
  layout(title = "Population Growth vs Net Migration",
         xaxis = list(type = "log", title = "Population Growth Rate"), 
         yaxis = list(type = "log", title = "Net Migration Rate"),
         paper_bgcolor = 'rgba(0,0,0,0)',
         plot_bgcolor = 'rgba(0,0,0,0)') %>% 
  highlight(on = "plotly_click", persistent = TRUE) # persistent = TRUE allows multiple selections

bscols(widths = c(2, 5, 5), # Arrangement of panes in output
       list(filter_select(id = "countries", label = "Select a Country",
                  sharedData = shared_data, group = ~country), # Searchable Filter
            filter_slider(id = "birthslide", label = "Birth rate",
                 sharedData = shared_data, column = ~birth_rate), # Slider Filters
            filter_slider(id = "deathslide", label = "Death rate",
                 sharedData = shared_data, column = ~death_rate)),
       p1, p2) -> linked_plot # The Two subplots
  
```
]]
</details>

<details>
  <summary>
  Linked Plots
  </summary>
.details[
```{r eval=TRUE, warning=FALSE, message=FALSE, echo=FALSE}
linked_plot
  
```
]
</details>
---
class: hide-logo, inverse, center, middle

# Resources

---

# Resources 

If you're interested in learning more about plotly, check these out: 
- 
- 
- 

--- 

# Conclusion

- plotly is an R package for creating **interactive** and **dynamic** **web-based** graphics  
- plotly graphics can be created by (1) converting ggplot() graphics and (2) initializing directly with plot_ly()
- Key features include the ability to animate graphs, links plots & filters, allow audience to interact with your data 

---
background-image: url(https://imgs.xkcd.com/comics/scientific_paper_graph_quality_2x.png)

--- 
class: hide-logo, inverse, center, middle

# Let's practice!

